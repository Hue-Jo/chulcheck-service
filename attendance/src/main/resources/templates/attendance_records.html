<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="robots" content="noindex, nofollow">

  <title>출석 내역 조회</title>
  <link rel="stylesheet" href="/css/record.css"/>
  <link rel="stylesheet" href="/css/nav.css"/>
  <script src="/js/nav.js"></script>
</head>

<body>

<h1>
  <a th:href="@{/attendance/records}">💾 출석 내역 조회</a>
</h1>

<form th:action="@{/attendance/records}" method="get" class="filter-section">
  <label for="date">날짜 :</label>
  <select name="date" id="date" required onchange="this.form.submit()">
    <option value="" disabled selected>날짜를 선택하세요</option>
    <option th:each="date : ${dates}" th:value="${#temporals.format(date, 'yyyy-MM-dd')}"
            th:text="${#temporals.format(date, 'yyyy-MM-dd')}"
            th:selected="${selectedDate == #temporals.format(date, 'yyyy-MM-dd')}"></option>
  </select>
</form>

<hr/>

<div th:if="${summaryList != null} and ${attendances} == null">
  <div class="summary-header">
    <h3 style="margin: 0;">📢 오늘의 출석 요약</h3>
    <button class="scroll-button"
            onclick="window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });">⬇
    </button>
  </div>
  <table>
    <thead>
    <tr>
      <th>셀 이름</th>
      <th>출석 인원</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="summary : ${summaryList}">
      <td th:text="${summary.cellName}"></td>
      <td th:text="${summary.presentCount}"></td>
    </tr>
    </tbody>
  </table>
</div>

<div th:if="${cellAttendanceMap != null}">
  <div class="card-container">
    <div class="card-wrapper" th:each="entry : ${cellAttendanceMap}">
      <div class="card">
        <h3 th:text="${entry.key.name + ' (출석 : ' + entry.value.presentCount + '명)'}"></h3>
        <table>
          <thead>
          <tr>
            <th>이름</th>
            <th>출결</th>
            <th>결석 사유</th>
          </tr>
          </thead>
          <tbody>
          <tr th:if="${#lists.isEmpty(entry.value.attendanceList)}">
            <td colspan="3" style="font-style: italic;">아직 출석 정보가 없습니다.</td>
          </tr>
          <tr th:each="att : ${entry.value.attendanceList}">
            <td th:text="${att.student.name}"></td>
            <td>
              <span th:if="${att.status.name() == 'PRESENT' or att.status.name() == 'ALLOWED'}"
                    class="present">✅</span>
              <span th:if="${att.status.name() == 'ABSENT'}" class="absent">❌</span>
            </td>
            <td>
                <span
                    th:if="${att.status == T(smmiddle.attendance.constant.AttendanceStatus).ABSENT || att.status == T(smmiddle.attendance.constant.AttendanceStatus).ALLOWED}">
                  <span
                      th:text="${att.absenceReason != null ? att.absenceReason.displayName : ''}"></span>
                  <span
                      th:if="${att.absenceReason == T(smmiddle.attendance.constant.AbsenceReason).OTHER and att.customReason != null}">: <span
                      th:text="${att.customReason}"></span></span>
                </span>
              <span
                  th:if="${att.status == T(smmiddle.attendance.constant.AttendanceStatus).PRESENT}">-</span>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div th:replace="~{nav :: bottom-nav}"></div>


</body>

</html>